
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Snapshots &#8212; Petitboot v1.10.3 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="IPMI" href="ipmi.html" />
    <link rel="prev" title="Auto Boot Order" href="autoboot.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="snapshots">
<span id="id1"></span><h1>Snapshots<a class="headerlink" href="#snapshots" title="Permalink to this headline">¶</a></h1>
<p>By default Petitboot does not directly mount any block devices. Instead it uses the device-mapper <a class="reference external" href="https://www.kernel.org/doc/Documentation/device-mapper/snapshot.txt">snapshot</a> device to mount an in-memory representation of the device. Any writes Petitboot or another part of the system may make to the device are written to memory rather than the physical device, providing a “real” read-only guarantee beyond just that provided by the filesystem.</p>
<p>In normal operation this is completely transparent but there are two scenarios where actual writes are desired:</p>
<div class="section" id="saving-bootloader-data">
<h2>Saving bootloader data<a class="headerlink" href="#saving-bootloader-data" title="Permalink to this headline">¶</a></h2>
<p>Some configuration formats include directives to save some data before boot - like GRUB’s ability to record the last option booted. Snapshots will prevent this but Petitboot can be configured to merge these writes back to the source device by enabling the “”Allow bootloader scripts to modify disks” option in the System Configuration screen.</p>
</div>
<div class="section" id="manual-interaction">
<h2>Manual interaction<a class="headerlink" href="#manual-interaction" title="Permalink to this headline">¶</a></h2>
<p>Any writes to a block device first mounted by Petitboot will by default be thrown away. If a user makes changes to a disk or USB device for example that they want to preserve they can tell Petitboot to merge these writes to the source device with the “sync” event. For example if the user had written something to the sda2 partition, in the shell they can run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pb-event sync@sda2
</pre></div>
</div>
<p>Petitboot will handle the merging itself and remount the device read-only.</p>
<p>If desired snapshots can also be disabled via the “petitboot,snapshots?” parameter. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>nvram --update-config petitboot,snapshots?=false
</pre></div>
</div>
<p>As of the next boot Petitboot will mount block devices directly.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Petitboot</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Petitboot Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../components.html">Petitboot Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../platforms.html">Platforms</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/design.html">Design Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/submitting.html">Development and Submitting Patches</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/linux-image.html">Linux Image Requirements</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="parsers.html">Configuration Parsers</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_interface.html">User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="autoboot.html">Auto Boot Order</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Snapshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="ipmi.html">IPMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">Plugins</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="autoboot.html" title="previous chapter">Auto Boot Order</a></li>
      <li>Next: <a href="ipmi.html" title="next chapter">IPMI</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Samuel Mendoza-Jonas, IBM.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/func/snapshots.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>